<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;400;500;700;900&family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap">
        <style>
            * {font-family:"Noto Sans", "Noto Sans JP", "Noto Sans KR"; font-size:15px}
            html, body {margin:0; padding:0; background:#0d1117}
            .disclaimer {position:absolute; left:32px; bottom:0; right:0; height:32px; line-height:32px; color:#AAA;}
            .content {position:fixed; left:241px; right:0 ; bottom:32px; top:0; overflow-x:scroll; overflow-y:scroll;}

            .content .tabpage {display:none}
            .content .tabpage.active {display:inline-block;}
            .content .tabpage>.table {display:table;}

            .bottom {background:#161b22; height:32px; position:fixed; left:0; right:0; bottom:0; border-top:1px solid #30363d}
            
            ::-webkit-scrollbar {height: 8px; width: 8px; background:#016F46}
            ::-webkit-scrollbar-corner {background:#21262d;}
            ::-webkit-scrollbar-track {background:#21262d; padding:2px}
            ::-webkit-scrollbar-thumb {background:#016F46; border-radius:4px; border:2px solid #21262d}
            .top {position:fixed; left:0; bottom:0; top:0; width:240px; line-height:32px; border-right:1px solid #30363d; background:#161b22; display:flex; overflow:auto; flex-direction: column;}
            .top>.tab {padding: 0 12px 0 16px; border-bottom:1px solid #21262d; font-size:15px; cursor:pointer; min-width:100px; color:#c9d1d9; user-select:none}
            .top>.tab.active {box-shadow:inset 2px 0 0 #016F46; background:#21262d; font-weight:bold}

            .rowheader {display:table-header-group; background:#161b22; position:sticky; top:0; z-index:2;}
            .row {display:table-row}
            .row:nth-child(odd) {background:#161b22}
            .cell {display:table-cell; padding:4px 8px; line-height:24px; border-style:solid; border-width:0 1px 1px 0; border-color:#30363d; color:#c9d1d9}
            .cell.fill {min-width:50%}

            .inactivated>.cell {color:#303030}

            .icon {width:24px; background-size:24px 24px; background-position:50% 50%; background-repeat:no-repeat; background-image:url(./icons/000000/000650_hr1.png);}
            desc_g, desc_o {display:inline}
            desc_g {color:#00A000;}
            desc_o {color:#F08000;}

            buff {display:inline-block; position:relative; padding-left:20px; background-position:0px 50%; background-size:16px auto; background-repeat:no-repeat; color:#F08000; background-image:var(--url);cursor:pointer;}
            buff::before {display:none; content:""; width:48px; height:64px; position:absolute; top:-24px; left:-16px;background-image:var(--url); pointer-events: none;}
            buff:hover::before {display:block;}
            dsy {display:inline; color:#F0E080;}
            dsg {display:inline; color:#00A000;}
            dso {display:inline; color:#F08000;}
        </style>
        <script src="https://sharlayan.io/lib/achernar.0.2.1.js"></script>
    </head>
    <body>
        <div class="top">

        </div>
        <div class="content">

        </div>
        <div class="bottom">
            <div class="disclaimer">
                disclaimer: '번역' 항목은 유저 번역이므로 공식 출시 시 이름이 변경될 수 있습니다.
            </div>
        </div>
    </body>
    <script>
        let firsttab = false;

        function uuid()
        {
            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        };

        function loadJSON(path)
        {
            let t = new XMLHttpRequest();
            t.overrideMimeType("application/json");
            t.open("GET",path,true);
            t.onreadystatechange = function()
            {
                if (t.readyState === 4 && t.status == "200")
                {
                    try
                    {
                        let json = JSON.parse(t.responseText);

                        let floor = json.data;
                        let a = json.tag;
                        let r = json.type;
                        let c = json.title;

                        let _name = [kr[a] ? kr[a] : a, kr[r] ? kr[r] : r, kr[c] ? kr[c] : c].join(" ");
                        let tab = $(".top").new("div", "tab", _name);
                        let page = $(".content").new("div", "tabpage");
                        page.setAttribute("tabname", _name);
                        let table = page.new("div", "table");

                        let name = table.new("div", "rowheader");
                        name.new("div", "cell", "No");
                        name.new("div", "cell", "");
                        //name.new("div", "cell", "한국어");
                        name.new("div", "cell", "일어");
                        name.new("div", "cell", "영어");
                        name.new("div", "cell", "번역");
                        name.new("div", "cell", "설명");

                        let namingway = {"Id":uuid(), "Name":_name, "Actions":{}};

                        for(var l in floor)
                        {
                            let iconURL = "";
                            if (floor[l].iconid != undefined)
                            {
                                let folder = "./icons/",
                                    folder_ex = Math.floor(floor[l].iconid / 1000);

                                iconURL = folder + (folder_ex+"").padStart(3,"0") + "000/" + (floor[l].iconid + "").padStart(6,"0") + "_hr1.png";
                            }

                            let desc = floor[l].desc != undefined ? floor[l].desc : "-";
                            if (desc != "-")
                            {
                                desc = desc.replace(/\{b:(.*?);([^}]+)}/g, "<buff style=\"--url:url($2);\">$1</buff>");
                                desc = desc.replace(/\{y:(.*?)}/g, "<dsy>$1</dsy>");
                                desc = desc.replace(/\{g:(.*?)}/g, "<dsg>$1</dsg>");
                                desc = desc.replace(/\{o:(.*?)}/g, "<dso>$1</dso>");
                            }

                            let row = table.new("div", "row");
                            row.new("div", "cell", l);
                            let icon = row.new("div", ["cell", "icon"]);
                            if (iconURL) icon.css("background-image", "url(" + iconURL + ")");
                            // row.new("div", "cell", floor[l].ko != undefined ? floor[l].ko : "-");
                            row.new("div", "cell", floor[l].ja != undefined ? floor[l].ja : "-");
                            row.new("div", "cell", floor[l].en != undefined ? floor[l].en : "-");
                            row.new("div", "cell", floor[l].ko_trans != undefined ? floor[l].ko_trans : "-");
                            row.new("div", ["cell", "fill"], desc);

                            if (!floor[l].desc) row.classList.add("inactivated");
                            if (floor[l].ko_trans != undefined) namingway.Actions[l] = floor[l].ko_trans + " (" + l + ")";
                        }
                        // console.log(JSON.stringify(namingway));
                        tab.addEventListener("click", (e) =>
                        {
                            $(".tabpage").forEach((x) => {x.classList.remove("active");});
                            $(".tab").forEach((x) => {x.classList.remove("active");});

                            $(".tabpage[tabname=\"" + e.target.innerHTML + "\"]").classList.add("active");
                            e.target.classList.add("active");
                        });

                        if (!firsttab)
                        {
                            tab.classList.add("active");
                            $(".tabpage[tabname=\"" + tab.innerHTML + "\"]").classList.add("active");
                            firsttab = 1;
                        }
                    }
                    catch(ex) { }
                }
            }
            t.send(null);
        }

        const
        kr = {
            "万魔殿・辺獄編":"만마전: 변옥편",
            "normal":"일반",
            "f1":"1층",
            "f2":"2층",
            "f3":"3층",
            "f4":"4층",
        },
        loadFiles = [
            "./cluster/sage.json",
            "./cluster/p1n.json",
            "./cluster/p2n.json",
            "./cluster/p3n.json",
            "./cluster/p4n.json",
        ];

        for(let i of loadFiles)
        {
            loadJSON(i);
        }
    </script>
</html>